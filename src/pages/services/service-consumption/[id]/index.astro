---
// TYPES //
import type { Service } from "../../../../types/services";

// CONSTANTS //
import { API_URL } from "../../../../constants";

// OTHERS //
import Layout from "../../../../layouts/Layout.astro";

// SECTIONS //
import Description from "../../../../sections/service-consumption/Description.astro";
import Hero from "../../../../sections/service-consumption/Hero.astro";
import BeforeAfter from "../../../../sections/service-consumption/BeforeAfter.astro";
import ServiceSlider from "../../../../sections/service-consumption/ServiceSlider.astro";
import ContactUs from "../../../../sections/home/ContactUs.astro";

export const prerender = false;

// Take the id from the URL
const { id } = Astro.params;

// Fetch the service details based on the id
let servicesConsumption: Service = {
  name: "",
  icon: "",
  id: "",
  category_id: "",
  photos: [],
  before_after: [],
  description_image_urls: [],
  description_pointers: [],
};

try {
  const res = await fetch(API_URL);
  const json = await res.json();
  servicesConsumption = json?.data?.services_info.services?.find(
    (s: Service) => s.id === id
  ) ?? {
    name: "",
    icon: "",
    id: "",
    category_id: "",
    photos: [],
    before_after: [],
  };
} catch (e) {
  console.error(e);
}
---

<!-- Render service details here -->
<Layout>
  {
    servicesConsumption && (
      <>
        <Hero title={servicesConsumption.name} />
        {servicesConsumption.description_pointers && (
          <Description serviceConsumption={servicesConsumption} />
        )}
        {servicesConsumption.photos && (
          <ServiceSlider photos={servicesConsumption.photos} />
        )}
        {servicesConsumption.before_after && (
          <BeforeAfter beforeAfterItems={servicesConsumption.before_after} />
        )}
        <ContactUs />
      </>
    )
  }
</Layout>
